# WTHGIS Parcel Enricher - General Purpose

A flexible Python script to scrape property data from any WTHGIS county portal. Supports multiple input formats (TXT, CSV, XLSX) and automatically enriches parcel data with owner information, addresses, legal descriptions, and downloads Property Record Card PDFs.

## Features

- **Flexible Input**: Accepts TXT, CSV, or XLSX files with parcel IDs
- **Multi-County Support**: Works with any WTHGIS portal (configurable base URL)
- **Polite Scraping**: Built-in delays to avoid overwhelming servers
- **Batch Processing**: Opens browser once for all lookups (efficient)
- **Auto-Generated Output**: Creates timestamped Excel files with enriched data
- **PDF Downloads**: Automatically downloads Property Record Cards

## Installation

```bash
pip install requests beautifulsoup4 openpyxl playwright pandas
python -m playwright install chromium
```

## Usage

### Basic Usage

```bash
# With TXT file (one parcel ID per line)
python main.py --input parcels.txt --county "Jennings"

# With CSV file
python main.py --input parcels.csv --county "Monroe"

# With XLSX file
python main.py --input parcels.xlsx --county "Brown"
```

### With Custom Base URL

```bash
python main.py --input parcels.txt --county "Jennings" --base-url https://jenningsin.wthgis.com
```

### Advanced Options

```bash
python main.py \
  --input parcels.xlsx \
  --county "Monroe" \
  --base-url https://monroein.wthgis.com \
  --sheet "Sheet1" \
  --downloads "PDFs_Monroe" \
  --output "monroe_enriched.xlsx" \
  --max 50 \
  --headed
```

## Input File Formats

### TXT Format
```
12-34-56-789-012.000-001
12-34-56-789-013.000-001
12-34-56-789-014.000-001
```

### CSV Format
```csv
Parcel ID
12-34-56-789-012.000-001
12-34-56-789-013.000-001
12-34-56-789-014.000-001
```

Or just a simple list:
```csv
12-34-56-789-012.000-001
12-34-56-789-013.000-001
12-34-56-789-014.000-001
```

### XLSX Format
Any Excel file with parcel IDs in the first column or a column named "Parcel ID".

## Output

The script generates:
- **Enriched Excel file**: `<input>_<county>_<timestamp>_ENRICHED.xlsx` with columns:
  - Parcel ID
  - Owner Name, Address, City, State, Zip
  - Property Address, City, State, Zip
  - Legal Description
  - Document/Instrument Number
  - Report Card Path
  - Status and Notes
  
- **PDF folder**: `PRC_<county>/` containing Property Record Card PDFs named by owner

## Command-Line Options

| Option | Description | Default |
|--------|-------------|---------|
| `--input` | Input file path (required) | - |
| `--county` | County name (required) | - |
| `--base-url` | WTHGIS portal URL | Auto-constructed from county |
| `--sheet` | Excel sheet name | First sheet |
| `--downloads` | PDF output folder | `PRC_<county>` |
| `--output` | Output Excel path | Auto-generated |
| `--max` | Max parcels to process | 0 (no limit) |
| `--save-every` | Save every N parcels | 10 |
| `--headed` | Show browser window | Hidden by default |
| `--page-delay-min/max` | Delay between page requests (seconds) | 2.5-6.0 |
| `--pdf-delay-min/max` | Delay between PDF downloads (seconds) | 6.0-12.0 |

## Examples

### Example 1: Simple TXT file
```bash
python main.py --input my_parcels.txt --county "Jennings"
```

### Example 2: CSV with custom output location
```bash
python main.py --input parcels.csv --county "Monroe" --downloads "Monroe_PDFs" --output "monroe_results.xlsx"
```

### Example 3: Process only first 10 parcels (testing)
```bash
python main.py --input parcels.xlsx --county "Brown" --max 10 --headed
```

### Example 4: Different county with custom URL
```bash
python main.py --input parcels.txt --county "Lawrence" --base-url https://lawrencein.wthgis.com
```

## Notes

- The script is "polite" by design - it includes delays between requests to avoid overwhelming county servers
- Browser runs headless by default; use `--headed` to see what's happening
- Output files are timestamped to avoid overwriting previous runs
- If base URL is not provided, script attempts to construct it as `https://<county>in.wthgis.com`
- The script saves progress every 10 parcels (configurable with `--save-every`)

## Troubleshooting

**"Could not find parcel in WTHGIS search"**
- Verify the parcel ID format matches what the county portal expects
- Try searching manually on the portal to confirm the parcel exists

**Browser timeout errors**
- Increase timeout: `--browser-timeout-ms 60000`
- Check your internet connection
- Try with `--headed` to see what's happening

**Missing data in output**
- Some counties may have different HTML structures
- The script extracts what's available; missing fields are left blank
